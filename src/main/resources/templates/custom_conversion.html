<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="../resources/static/img/rosetta-32x32.png">
    <title>自定义数据预处理</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/css/fileinput.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/css/fileinput-rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/themes/explorer-fa/theme.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/js/plugins/sortable.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.7/js/fileinput.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/js/locales/fr.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/js/locales/es.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/themes/explorer-fa/theme.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/themes/fa/theme.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.4.8/js/locales/zh.min.js"></script>
</head>
<style>
    #head{
        width: 100%;
        padding: 0 0 0 0;
        margin: 0;
        height: 80px;
        background-color: #041e2e;
    }
    #ahead{
        display: block;
        max-width: 1200px;
        margin: 0 auto;
        height: 80px;
        line-height: 80px;
    }
    #headimg{
        display: block;
        max-width: 1200px;
        float: left;
        margin-top:10px;
        line-height: 80px;
    }
    #body{
        padding: 0 0 0 0;
        margin: 0;
    }
    #functionbody{
        position:absolute;
        left: 15%;
        top: 15%;
    }
    #end{
        padding: 0 0 0 0;
        margin: 0;
    }
    #text{
        position: absolute;
        left: 100px;
    }
</style>
<body>
<div style="height: 100%;width: 100% ;position: absolute">
    <div class="form-group" id="head">
        <a id="ahead" class="noicon" href="https://unidata.ucar.edu/software/rosetta/">
            <img id="headimg" src="img/ckan-logo.png" alt="中国科学院海洋研究所-数据处理平台"></a>
    </div>
      <div class="form-group"style="height:595px; background-color: #d8e9ff" id="body">
        <!--<a href="doPost.html">sopost</a>-->
        <!--<input type="button" value="test" onclick="Test()">-->
        <div id="functionbody" class="col-sm-8" style="width: 70%; height: 70%;background-color: seashell">
            <p style="font-size: 15px">请填写所需的处理数据</p>  <input type="button" value="添加" onclick="addLine()">
            <form id="inputInfo">
             <table id="dataType" border="1" style="height: 100%;width: 80%">
                 <tr><td ></td><td>数据名称</td></tr>
                <tr>
                    <td style="width: 15%">1</td>
                    <td><input name="key" value="lat" readonly = "true" style="width: 100%"><br/></td>
                </tr>
                 <tr>
                     <td style="width: 15%">2</td>
                     <td><input name="key" value="lon" readonly = "true" style="width: 100%"><br/></td>
                 </tr>
                 <tr>
                     <td style="width: 15%">3</td>
                     <td><input name="key" value="datetime" readonly = "true" style="width: 100%"><br/></td>
                 </tr>
                 <tr>
                     <td style="width: 15%">4</td>
                     <td><input name="key" value="depth" readonly = "true" style="width: 100%"><br/></td>
                 </tr>
                 <tr>
                     <td style="width: 15%">5</td>
                     <td><input name="key" value="temperature" readonly = "true" style="width: 100%"><br/></td>
                 </tr>
                 <tr>
                     <td style="width: 15%">6</td>
                     <td><input name="key" value="salinity" readonly = "true" style="width: 100%"><br/></td>
                 </tr>

             </table>
            </form>
        </div>
      </div>
    <div class="form-group" id="end" style="background-color: #041e2e ;height:80px;width: 100%">
        <div id="text">
            <p style="color: white; font-size: 10px" >中国科学院海洋研究所</p>
            <p style="color: white; font-size: 10px">sjzx@qdio.ac.cn</p>
        </div>
    </div>
</div>
<script type="text/javascript">
    function addLine() {
        var tab = document.getElementById("dataType") ;
        var rows = tab.rows ;
        for(var j = 1; j<rows.length; j++){
            var value =  rows[j].cells[1].innerHTML
            console.log(value.value)
        }
    }

</script>
<!--<script type="text/javascript">
    //判断提交文件类型
    function judgeData(){
        var value = $("#type").find("option:selected").attr("value");
        if (value == 0){
            submitCsvData()
        }
        if (value == 1){
            submitCnvData()
        }if(value == 2){
            submitADCPData()
        }
    }
    //判断上传文件夹类型
    function judgeFolder() {
        var value = $("#folderType").find("option:selected").attr("value");
        if (value == 0){
            submitListData()}
        if (value == 1){
            submitCnvFolder()}
        if(value == 2){
            CTD()}
        if(value == 3){
            submitADBCFolder()
        }
    }//判断合并文件的类型
    function judgeMergeFolder(){
        var value = $("#mergeFolderTypes").find("option:selected").attr("value");
        var url  = null;
        if(value == 0){url ="/mergeCsvFolder"}//合并csv
        if(value == 1){mergeCnv()}//合并cnv
        var data_file = document.getElementById("input-lists");
        for(var i= 0;i<data_file.files.length;i++){
            var fileObj = data_file.files[i];
            var formData= new FormData();
            formData.append("fileobj",fileObj);
            var file = data_file.files[i].webkitRelativePath;//判断是否是规定格式文件
            var type = file.substring(file.lastIndexOf("."),file.length)
            if(type!=".csv"){
                continue
            }
            $.ajax({
                type:"POST",
                url:url+"?i="+i,
                data:formData,
                async: false,
                processData: false,
                contentType: false,
                success:function(result){
                    if (result == "true"){
                    } else {
                        alert(result+"文件生成出错")
                    }
                },
                error:function () {
                    alert("上传失败")
                }
            });
        }alert("上传完成")
        document.getElementById("download-mergefile").style.display = "block";
    }
    function change() {
        var checked = $('input:radio[name="check"]:checked').val();
        if(checked == "单个处理文件"){
            document.getElementById("file").style.display = "block"
            document.getElementById("folder").style.display = "none"
            document.getElementById("merge").style.display = "none"
        }if(checked == "批量处理文件"){
            document.getElementById("folder").style.display = "block"
            document.getElementById("file").style.display = "none"
            document.getElementById("merge").style.display = "none"
        }if(checked == "批量处理文件且合并"){
            document.getElementById("merge").style.display = "block"
            document.getElementById("file").style.display = "none"
            document.getElementById("folder").style.display = "none"
        }
    }
    //判断下载文件类型
    function  fileDownload(){
        var checked = $('input:radio[name="check"]:checked').val();
        var file = null;
        var filename = null;
        if(checked == "批量处理文件且合并"){
            var data_file = document.getElementById("input-lists");
            file = data_file.files[0].webkitRelativePath;
            filename = file.split("/")[0];
            document.getElementById("download-mergefile").href="/filedownload?name="+filename;
            document.getElementById("download-mergefile").style.display = "none"
        }else {
            file = $("#cert").val();
            var pos=file.lastIndexOf("\\");
            filename = file.substring(pos+1);
            document.getElementById("download-zip").href="/filedownload?name="+filename;
            document.getElementById("download-zip").style.display = "none"}

    }//下载文件夹
    function folderDownload(){
        var value = $("#folderType").find("option:selected").attr("value")
        var data_file = document.getElementById("input-list");
        var file = data_file.files[0].webkitRelativePath;
        var filename = file.split("/")[0];
        $('#download-folderzip').attr('href','/folderdownload?foldername='+filename);
        /*$("download-folderzip").hide();*/
        document.getElementById("download-folderzip").style.display = "none"
    }
    //上传csv文件
    function submitCsvData(){
        var data_file = document.getElementById("cert");
        var fileObj = data_file.files[0];
        var formData= new FormData();
        if(fileObj == null){
            alert("请选中文件")
            return
        }
        formData.append("fileobj",fileObj);
        $.ajax({
            type:"POST",
            url:"/conversion",
            data:formData,
            async: false,
            processData: false,
            contentType: false,
            success:function(result){
                if(result == "wrongfile"){
                    alert("请选择正确格式文件")
                }if(result == "false"){
                    alert("失败")
                }
                else {
                    alert("上传成功")
                    document.getElementById("download-zip").style.display = "block"
                }
            },
            error:function () {
                alert("上传失败")
            }
        });
    }
    //上传cnv文件
    function submitCnvData(){
        var data_file = document.getElementById("cert");
        var fileObj = data_file.files[0];
        var formData= new FormData();
        if(fileObj == null){
            alert("请选中文件")
            return
        }
        formData.append("fileobj",fileObj);
        $.ajax({
            type:"POST",
            url:"/importFileCnv",
            data:formData,
            async: false,
            processData: false,
            contentType: false,
            success:function(result){
                if(result == "wrongfile"){
                    alert("请选择正确格式文件")
                }if(result == "noHeader"){
                    alert("文件内容有误")
                }if(result == "false"){
                    alert("生成失败")
                }
                else {
                    alert("上传成功")
                    document.getElementById("download-zip").style.display = "block"
                }
            },
            error:function () {
                alert("上传失败")
            }
        });
    }//上传ADCP文件
    function submitADCPData(){
        var data_file = document.getElementById("cert");
        var fileObj = data_file.files[0];
        var formData= new FormData();
        if(fileObj == null){
            alert("请选中文件")
            return
        }
        formData.append("fileobj",fileObj);
        $.ajax({
            type:"POST",
            url:"/importADCPFile",
            data:formData,
            async: false,
            processData: false,
            contentType: false,
            success:function(result){
                if(result == "wrongfile"){
                    alert("请选择正确格式文件")
                }if(result == "false"){
                    alert("文件读取失败")
                }
                else {
                    alert("上传成功")
                    document.getElementById("download-zip").style.display = "block"
                }
            },
            error:function () {
                alert("上传失败")
            }
        });
    }
    //上传csv文件夹
    function submitListData() {
        var data_file = document.getElementById("input-list");
        for(var i= 0;i<data_file.files.length;i++){
            var fileObj = data_file.files[i];
            var formData= new FormData();
            formData.append("fileobj",fileObj);
            var file = data_file.files[i].webkitRelativePath;//判断是否是规定格式文件
            var type = file.substring(file.lastIndexOf("."),file.length)
            console.log(file)
            if(type!=".csv"){
                continue
            }
            $.ajax({
                type:"POST",
                url:"/folderConversion",
                data:formData,
                async: false,
                processData: false,
                contentType: false,
                success:function(result){
                    if (result == "true"){

                    } else {
                        alert("文件生成出错")
                    }
                },
                error:function () {
                    alert("上传失败")
                }
            });
        }alert("上传完成")
        document.getElementById("download-folderzip").style.display = "block";}
    //上传CNV文件夹
    function submitCnvFolder() {
        var data_file = document.getElementById("input-list");
        for(var i= 0;i<data_file.files.length;i++){
            var fileObj = data_file.files[i];
            var formData= new FormData();
            formData.append("fileobj",fileObj);
            var file = data_file.files[i].webkitRelativePath;//判断是否是规定格式文件
            var type = file.substring(file.lastIndexOf("."),file.length)
            if(type!=".cnv"){
                continue
            }
            $.ajax({
                type:"POST",
                url:"/importFolderCnv",
                data:formData,
                async: false,
                processData: false,
                contentType: false,
                success:function(result){
                    if (result == "true"){
                    } /*else {
                        alert(result+"文件生成出错")
                    }*/
                },
                error:function () {
                    alert("上传失败")
                }
            });
        }alert("上传完成")
        document.getElementById("download-folderzip").style.display = "block";
    }//上传定点CTD的cnv格式文件夹
    function CTD() {
        var data_file = document.getElementById("input-list");
        for(var i= 0;i<data_file.files.length;i++){
            var fileObj = data_file.files[i];
            var file = data_file.files[i].webkitRelativePath;
            var type = file.substring(file.lastIndexOf("."),file.length)
            if(type!=".cnv"){
                continue
            }
            console.log(file)
            var formData= new FormData();
            formData.append("fileobj",fileObj);
            $.ajax({
                type:"POST",
                url:"/importCTDFolderCnv",
                data:formData,
                async: false,
                processData: false,
                contentType: false,
                success:function(result){
                    if (result == "true") {

                    }else {alert(result+"文件生成出错")}
                },
                error:function () {
                    alert("上传失败")
                }
            });
        }
        document.getElementById("download-folderzip").style.display = "block";
        alert("上传完成")
    }//上传ADCP文件夹
    function submitADBCFolder() {
        var data_file = document.getElementById("input-lists");
        var url = null;
        for (var i = 0; i < data_file.files.length; i++) {
            var fileObj = data_file.files[i];
            var file = data_file.files[i].webkitRelativePath;
            var type = file.substring(file.lastIndexOf("."), file.length)
            if (type != ".DAT") {
                continue
            }
            console.log(file)
            var formData = new FormData();
            formData.append("fileobj", fileObj);
            $.ajax({
                type: "POST",
                url: "/importADCPFile",
                data: formData,
                async: false,
                processData: false,
                contentType: false,
                success: function (result) {
                    if (result == "true") {
                    }
                },
                error: function () {
                    alert("上传失败")
                }
            });
        }alert("上传完成")
        document.getElementById("download-folderzip").style.display = "block";
    }
    function mergeCsv(){

    }
    //合并cnv文件夹
    function mergeCnv(){
        var data_file = document.getElementById("input-lists");
        for(var i= 0;i<data_file.files.length;i++){
            var fileObj = data_file.files[i];
            var formData= new FormData();
            formData.append("fileobj",fileObj);
            var file = data_file.files[i].webkitRelativePath;//判断是否是规定格式文件
            var type = file.substring(file.lastIndexOf("."),file.length)
            if(type!=".cnv"){
                continue
            }
            $.ajax({
                type:"POST",
                url:"/mergeFolderCnv?i="+i,
                data:formData,
                async: false,
                processData: false,
                contentType: false,
                success:function(result){
                    if (result == "true"){
                    } else {
                        alert(result+"文件生成出错")
                    }
                },
                error:function () {
                    alert("上传失败")
                }
            });
        }alert("上传完成")
        document.getElementById("download-mergefile").style.display = "block";}
    function Test() {
        var a = "小米"
        alert(a)
        $.ajax({
            type:"GET",
            //url:"http://api.qichacha.com/JudgeDocV4/SearchJudgmentDoc?key=ApiKey&searchKey=瑞幸咖啡(北京)有限公司",
            url:"148.70.217.210:8081/getInfo/company/info?key=4ade3eeb224d4cd4a043e7c48184e7d9&searchKey=小米",
            //data:formData,
            cache:false,
            dataType: "jsonp",  //指定服务器返回的数据类型
            jsonp:'callback',//用以获得jsonp回调函数名的参数名(默认为:callback)

            jsonpCallback: "showData", //指定回调函数名称
            success:function(result){
                alert("成功")
                console.log(result)
            },
            error:function () {
                alert("失败")
            }
        });
    }
</script>-->

</body>

</html>